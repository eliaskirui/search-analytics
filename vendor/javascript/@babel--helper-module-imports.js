import*as e from"assert";import*as t from"@babel/types";var r="default"in e?e.default:e;var a="default"in t?t.default:t;var s={};Object.defineProperty(s,"__esModule",{value:true});s.default=void 0;var i=r;var n=a;const{callExpression:o,cloneNode:d,expressionStatement:l,identifier:u,importDeclaration:p,importDefaultSpecifier:f,importNamespaceSpecifier:m,importSpecifier:c,memberExpression:h,stringLiteral:_,variableDeclaration:v,variableDeclarator:b}=n;class ImportBuilder{constructor(e,t,r){this._statements=[];this._resultName=null;this._importedSource=void 0;this._scope=t;this._hub=r;this._importedSource=e}done(){return{statements:this._statements,resultName:this._resultName}}import(){this._statements.push(p([],_(this._importedSource)));return this}require(){this._statements.push(l(o(u("require"),[_(this._importedSource)])));return this}namespace(e="namespace"){const t=this._scope.generateUidIdentifier(e);const r=this._statements[this._statements.length-1];i("ImportDeclaration"===r.type);i(0===r.specifiers.length);r.specifiers=[m(t)];this._resultName=d(t);return this}default(e){const t=this._scope.generateUidIdentifier(e);const r=this._statements[this._statements.length-1];i("ImportDeclaration"===r.type);i(0===r.specifiers.length);r.specifiers=[f(t)];this._resultName=d(t);return this}named(e,t){if("default"===t)return this.default(e);const r=this._scope.generateUidIdentifier(e);const a=this._statements[this._statements.length-1];i("ImportDeclaration"===a.type);i(0===a.specifiers.length);a.specifiers=[c(r,u(t))];this._resultName=d(r);return this}var(e){const t=this._scope.generateUidIdentifier(e);let r=this._statements[this._statements.length-1];if("ExpressionStatement"!==r.type){i(this._resultName);r=l(this._resultName);this._statements.push(r)}this._statements[this._statements.length-1]=v("var",[b(t,r.expression)]);this._resultName=d(t);return this}defaultInterop(){return this._interop(this._hub.addHelper("interopRequireDefault"))}wildcardInterop(){return this._interop(this._hub.addHelper("interopRequireWildcard"))}_interop(e){const t=this._statements[this._statements.length-1];if("ExpressionStatement"===t.type)t.expression=o(e,[t.expression]);else if("VariableDeclaration"===t.type){i(1===t.declarations.length);t.declarations[0].init=o(e,[t.declarations[0].init])}else i.fail("Unexpected type.");return this}prop(e){const t=this._statements[this._statements.length-1];if("ExpressionStatement"===t.type)t.expression=h(t.expression,u(e));else if("VariableDeclaration"===t.type){i(1===t.declarations.length);t.declarations[0].init=h(t.declarations[0].init,u(e))}else i.fail("Unexpected type:"+t.type);return this}read(e){this._resultName=h(this._resultName,u(e))}}s.default=ImportBuilder;var g={};Object.defineProperty(g,"__esModule",{value:true});g.default=isModule$1;function isModule$1(e){return"module"===e.node.sourceType}var I="default"in e?e.default:e;var y="default"in t?t.default:t;var N={};Object.defineProperty(N,"__esModule",{value:true});N.default=void 0;var S=I;var D=y;var E=s;var w=g;const{numericLiteral:x,sequenceExpression:j}=D;class ImportInjector$1{constructor(e,t,r){this._defaultOpts={importedSource:null,importedType:"commonjs",importedInterop:"babel",importingInterop:"babel",ensureLiveReference:false,ensureNoContext:false,importPosition:"before"};const a=e.find((e=>e.isProgram()));this._programPath=a;this._programScope=a.scope;this._hub=a.hub;this._defaultOpts=this._applyDefaults(t,r,true)}addDefault(e,t){return this.addNamed("default",e,t)}addNamed(e,t,r){S("string"===typeof e);return this._generateImport(this._applyDefaults(t,r),e)}addNamespace(e,t){return this._generateImport(this._applyDefaults(e,t),null)}addSideEffect(e,t){return this._generateImport(this._applyDefaults(e,t),void 0)}_applyDefaults(e,t,r=false){let a;if("string"===typeof e)a=Object.assign({},this._defaultOpts,{importedSource:e},t);else{S(!t,"Unexpected secondary arguments.");a=Object.assign({},this._defaultOpts,e)}if(!r&&t){void 0!==t.nameHint&&(a.nameHint=t.nameHint);void 0!==t.blockHoist&&(a.blockHoist=t.blockHoist)}return a}_generateImport(e,t){const r="default"===t;const a=!!t&&!r;const s=null===t;const{importedSource:i,importedType:n,importedInterop:o,importingInterop:d,ensureLiveReference:l,ensureNoContext:u,nameHint:p,importPosition:f,blockHoist:m}=e;let c=p||t;const h=(0,w.default)(this._programPath);const _=h&&"node"===d;const v=h&&"babel"===d;if("after"===f&&!h)throw new Error('"importPosition": "after" is only supported in modules');const b=new E.default(i,this._programScope,this._hub);if("es6"===n){if(!_&&!v)throw new Error("Cannot import an ES6 module from CommonJS");b.import();s?b.namespace(p||i):(r||a)&&b.named(c,t)}else{if("commonjs"!==n)throw new Error(`Unexpected interopType "${n}"`);if("babel"===o)if(_){c="default"!==c?c:i;const e=`${i}$es6Default`;b.import();s?b.default(e).var(c||i).wildcardInterop():r?l?b.default(e).var(c||i).defaultInterop().read("default"):b.default(e).var(c).defaultInterop().prop(t):a&&b.default(e).read(t)}else if(v){b.import();s?b.namespace(c||i):(r||a)&&b.named(c,t)}else{b.require();if(s)b.var(c||i).wildcardInterop();else if((r||a)&&l)if(r){c="default"!==c?c:i;b.var(c).read(t);b.defaultInterop()}else b.var(i).read(t);else r?b.var(c).defaultInterop().prop(t):a&&b.var(c).prop(t)}else if("compiled"===o)if(_){b.import();s?b.default(c||i):(r||a)&&b.default(i).read(c)}else if(v){b.import();s?b.namespace(c||i):(r||a)&&b.named(c,t)}else{b.require();s?b.var(c||i):(r||a)&&(l?b.var(i).read(c):b.prop(t).var(c))}else{if("uncompiled"!==o)throw new Error(`Unknown importedInterop "${o}".`);if(r&&l)throw new Error("No live reference for commonjs default");if(_){b.import();s?b.default(c||i):r?b.default(c):a&&b.default(i).read(c)}else if(v){b.import();s?b.default(c||i):r?b.default(c):a&&b.named(c,t)}else{b.require();s?b.var(c||i):r?b.var(c):a&&(l?b.var(i).read(c):b.var(c).prop(t))}}}const{statements:g,resultName:I}=b.done();this._insertStatements(g,f,m);return(r||a)&&u&&"Identifier"!==I.type?j([x(0),I]):I}_insertStatements(e,t="before",r=3){const a=this._programPath.get("body");if("after"===t){for(let t=a.length-1;t>=0;t--)if(a[t].isImportDeclaration()){a[t].insertAfter(e);return}}else{e.forEach((e=>{e._blockHoist=r}));const t=a.find((e=>{const t=e.node._blockHoist;return Number.isFinite(t)&&t<4}));if(t){t.insertBefore(e);return}}this._programPath.unshiftContainer("body",e)}}N.default=ImportInjector$1;var P={};Object.defineProperty(P,"__esModule",{value:true});Object.defineProperty(P,"ImportInjector",{enumerable:true,get:function(){return H.default}});P.addDefault=addDefault;P.addNamed=addNamed;P.addNamespace=addNamespace;P.addSideEffect=addSideEffect;Object.defineProperty(P,"isModule",{enumerable:true,get:function(){return O.default}});var H=N;var O=g;function addDefault(e,t,r){return new H.default(e).addDefault(t,r)}function addNamed(e,t,r,a){return new H.default(e).addNamed(t,r,a)}function addNamespace(e,t,r){return new H.default(e).addNamespace(t,r)}function addSideEffect(e,t,r){return new H.default(e).addSideEffect(t,r)}const M=P.__esModule,U=P.ImportInjector,q=P.isModule;const $=P.addDefault,k=P.addNamed,C=P.addNamespace,L=P.addSideEffect;export{U as ImportInjector,M as __esModule,$ as addDefault,k as addNamed,C as addNamespace,L as addSideEffect,P as default,q as isModule};

